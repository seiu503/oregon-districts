@isTest
public with sharing class oregonDistrictsTest
{
	public class CalloutStaticClass {
    public static HttpResponse getInfoFromExternalService(String endpoint) {
        HttpRequest req = new HttpRequest();
        req.setEndpoint(endpoint);
        req.setMethod('GET');
        Http h = new Http();
        HttpResponse res = h.send(req);
        return res;
    }
	}	
	
    static testMethod void test()
    {
		Integer congressionalDistrict;
		Integer  statehouseDistrict;
		Integer statesenateDistrict;
		
		 // Use StaticResourceCalloutMock built-in class to
        // specify fake response and include response body 
        // in a static resource.
		StaticResourceCalloutMock mock = new StaticResourceCalloutMock();
		mock.setStaticResource('CallOutStaticResponse');
		mock.setStatusCode(200);
		mock.setHeader('Content-Type', 'application/json');
		
		String address = '3892+friar+ct+se%2csalem+or+97302';
		String testbody = '{"civic_data":{"congressionaldistrictnum":"5","statehousedistrictnum":"20","statesenatedistrictnum":"10"}}';
	
       Test.StartTest();
     // Http httpProtocol = new Http();
        // Create HTTP request to send.
     //   HttpRequest request = new HttpRequest();
        // Set the endpoint URL.
		 String endpoint = 'http://portal.opeuseiu.org/processes/google_civic_api_passthrough.php'
			+'?secretkey=WckiMNSfVZuFIprzcMpDbcKEMcWDOcIm'
            + '&address=' + address;

  //      request.setEndPoint(endpoint);
        // Set the HTTP verb to GET.
    //    request.setMethod('GET');
        // Send the HTTP request and get the response.
        // The response is in JSON format.
   //     HttpResponse response = httpProtocol.send(request);
      //  System.debug(response.getBody());
     
		 // Set the mock callout mode
        Test.setMock(HttpCalloutMock.class, mock);
        
        // Call the method that performs the callout
        HTTPResponse res = CalloutStaticClass.getInfoFromExternalService(endpoint);
		
		
		
        // Parse JSON response to get all the totalPrice field values.
      //  JSONParser parser = JSON.createParser(response.getBody());
	  JSONParser parser = JSON.createParser(res.getBody());
        congressionalDistrict = 0;
		statehouseDistrict = 0;
		statesenateDistrict = 0;
    
        String CD;
    	String HD;
    	String SD;
        while (parser.nextToken() != null) {
            if ((parser.getCurrentToken() == JSONToken.FIELD_NAME)) {
				if (parser.getText() == 'congressionaldistrictnum') {
					// Get the value.
					parser.nextToken();
					CD = parser.getText();
                    If (CD == null)
                 {
                    congressionalDistrict = 0;
                 }
                 If (CD != null)
                 {
                     congressionalDistrict = Integer.valueOf(CD);
                 }
                    
				}
			 if (parser.getText() == 'statehousedistrictnum') {
					// Get the value.
					parser.nextToken();
					HD = parser.getText();
                 If (HD == null)
                 {
                    statehouseDistrict = 0;
                 }
                 If (HD != null)
                 {
                     statehouseDistrict = Integer.valueOf(HD);
                 }
                     
				}
			   if (parser.getText() == 'statesenatedistrictnum') {
					// Get the value.
					parser.nextToken();
					 SD = parser.getText();
                    If (SD == null)
                 {
                    statesenateDistrict = 0;
                 }
                 If (SD != null)
                 {
                     statesenateDistrict = Integer.valueOf(SD);
                 }
				}
            }
		}
		
		 // Verify response received contains values returned by
        // the mock response.
        // This is the content of the static resource.
        System.assertEquals('{"civic_data":{"congressionaldistrictnum":"5","statehousedistrictnum":"20","statesenatedistrictnum":"10"}}', res.getBody());
        System.assertEquals(200,res.getStatusCode());
        System.assertEquals('application/json', res.getHeader('Content-Type'));  
		System.assertEquals(5,congressionalDistrict);
		System.assertEquals(20,statehouseDistrict);
		System.assertEquals(10,statesenateDistrict);
		
		
		
       Test.stopTest();
    }
}